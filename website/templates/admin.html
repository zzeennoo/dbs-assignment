<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- DataTables JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <style>
        #contentContainer {
            overflow-y: auto; /* Enable vertical scrolling for the content container */
            max-height: calc(100vh - 20px); /* Adjust as needed to leave space for the header */
        }

        #patientsDataTable {
            margin-bottom: 0; /* Remove the margin-bottom to fit the content container */
        }

        #sidebar {
            position: sticky;
            top: 0;
            background-color: #343a40;
            height: 100vh;
            padding-top: 20px;
            overflow-y: auto; /* Enable vertical scrolling for the sidebar */
        }
        #sidebar {
            background-color: #343a40;
            height: 100vh;
            padding-top: 20px;
        }

        #sidebar .nav-link {
            padding: 10px 20px;
            margin-bottom: 4px;
            border-radius: 8px;
            color: #fff;
        }

        #sidebar .nav-link.active {
            background-color: #007bff;
        }

        #addPatientButton {
            margin-bottom: 20px;
        }

        #goBackButton {
            margin-bottom: 20px;
            width: 100%;
        }

        #contentContainer {
            padding-top: 20px; /* Adjust this value as needed */
        }
        #searchForm {
            margin-bottom: 20px; /* Adjust the value as needed */
        }

        #searchButton {
            margin-top: 10px;
            margin-bottom: 20px; /* Add margin at the bottom */
        }
        /* Add margin to the patient list table */
        #filteredPatientsDataTable {
            margin-top: 20px; /* Adjust the value as needed */
        }
        #searchForm {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }

        #searchBar,
        #input_name,
        #input_id {
            padding: 10px; /* Adjust as needed */
            flex-grow: 1; /* Allow the input to grow and take available space */
        }


        #addPatientButton,
        .btn-primary,
        .btn-secondary {
            background-color: #007bff;
            color: #fff;
            border: none;
            transition: background-color 0.3s ease;
        }

        #addPatientButton:hover,
        .btn-primary:hover,
        .btn-secondary:hover {
            background-color: #0056b3; /* Darker shade on hover */
        }

        #addPatientButton,
        #addTreatmentButton,
        #addExamineButton {
            margin-bottom: 20px;
            display: inline-block;
        }

        .btn-add-treatment {
            background-color: #28a745; /* Green color */
            color: #fff; /* White text */
        }

        /* Style for "Add Examine" button */
        .btn-add-examine {
            background-color: #007bff; /* Blue color */
            color: #fff; /* White text */
        }

        #addTreatmentButton,
        #addExamineButton {
            margin-left: 10px; /* Add spacing between buttons */
        }
        

        


    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">

            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="position-sticky">
                    <!-- Go Back Button -->
                    <button id="goBackButton" type="button" class="btn btn-secondary" onclick="logout()">
                        Logout
                    </button>

                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#patient_list" onclick="changeTab(this)">
                                Patient List
                            </a>
                        </li>
            
                        <li class="nav-item">
                            <a class="nav-link" href="#search_export" onclick="changeTab(this)">
                                Search and Export
                            </a>
                        </li>
                        <!-- Add more sidebar items as needed -->
                    </ul>
                </div>
            </nav>


            <!-- Content here -->
            <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="container" id="contentContainer">
                    <!-- Content for Patient List -->
                    <div id="patientsTableContent">
                        <h2 id="patientsTable">Patient List</h2>
                        <!-- Add Patient Button -->
                        <button id="addPatientButton" type="button" class="btn btn-primary" data-toggle="modal" data-target="#addPatientModal">Add New Patient</button>
                    
                        <!-- Search Bar -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="searchBar" placeholder="Search by Name or Phone Number">
                        </div>

                        <button class="btn btn-primary" type="button" id="searchButton">Search</button>
                    
                        <table id="patientsDataTable" class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Phone Number</th>
                                    <th>Address</th>
                                    <th>Date of Birth</th>
                                    <th>Gender</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populate this section with data -->
                                {% for patient in patients %}
                                    <tr>
                                        <td>{{ patient.Code }}</td>
                                        <td>{{ patient.First_Name }}</td>
                                        <td>{{ patient.Last_Name }}</td>
                                        <td>{{ patient.Phone_number }}</td>
                                        <td>{{ patient.Address }}</td>
                                        <td>{{ patient.Date_of_Birth }}</td>
                                        <td>{{ patient.Gender }}</td>
                                        <td>
                                            <button class="btn btn-add-treatment btn-success btn-sm" onclick="addTreatment('{{ patient.Code }}')">Add Treatment</button>
                                            <button class="btn btn-add-examine btn-info btn-sm" onclick="addExamine('{{ patient.Code }}')">Add Examine</button>
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="8">No patients found. Error</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Modal to add patient-->
                    <div class="modal fade" id="addPatientModal" tabindex="-1" role="dialog" aria-labelledby="addPatientModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="addPatientModalLabel">Add New Patient</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                  <!-- Form for adding a new patient -->
                                  <form id="addPatientForm", action="{{ url_for('actor.add_patient') }}" method="POST">
                                    <div class="form-group">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="firstName">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="phoneNumber">Phone Number</label>
                                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber">
                                    </div>
                                    <div class="form-group">
                                        <label for="address">Address</label>
                                        <input type="text" class="form-control" id="address" name="address">
                                    </div>
                                    <div class="form-group">
                                        <label for="dateOfBirth">Date of Birth</label>
                                        <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth">
                                    </div>
                                    <div class="form-group">
                                        <label>Gender</label>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" id="male" name="gender" value="M">
                                            <label class="form-check-label" for="male">Male</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" id="female" name="gender" value="F">
                                            <label class="form-check-label" for="female">Female</label>
                                        </div>
                                        <div class="form-group">
                                            <label for="patientType">Patient Type</label>
                                            <select class="form-control" id="patientType" name="patientType" required>
                                                <option value="inpatient">Inpatient</option>
                                                <option value="outpatient">Outpatient</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="text" class="form-control" id="password" name="password" required>
                                    </div>
                                    <!-- Add more input fields as needed -->
                                
                                    <!-- Submit button -->
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </form>
                                
                              </div>
                          </div>
                      </div>
                    </div>
                    
                    <div class="modal" id="acceptTreatmentModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">Add Treatment</h4>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                    
                                <!-- Modal Body -->
                                <div class="modal-body">
                                    <!-- Form elements for treatment details -->
                                    <form id="acceptTreatmentForm">
                                        <!-- IP Detail -->
                                        <div class="mb-3">
                                            <label for="ICode" class="form-label">ICode:</label>
                                            <input type="text" class="form-control" id="ICode" name="ICode" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="admissionDate" class="form-label">Admission Date:</label>
                                            <input type="datetime-local" class="form-control" id="admissionDate" name="admissionDate" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="diagnosis" class="form-label">Diagnosis:</label>
                                            <textarea class="form-control" id="diagnosis" name="diagnosis" required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="sickroom" class="form-label">Sickroom:</label>
                                            <input type="text" class="form-control" id="sickroom" name="sickroom" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="dischargeDate" class="form-label">Discharge Date:</label>
                                            <input type="datetime-local" class="form-control" id="dischargeDate" name="dischargeDate" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="fee" class="form-label">Fee:</label>
                                            <input type="text" class="form-control" id="fee" name="fee" required>
                                        </div>
                    
                                        <!-- Treat Attribute -->
                                        <div class="mb-3">
                                            <label for="doctorID" class="form-label">Doctor ID:</label>
                                            <input type="text" class="form-control" id="doctorID" name="doctorID" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="startDatetime" class="form-label">Start Datetime:</label>
                                            <input type="datetime-local" class="form-control" id="startDatetime" name="startDatetime" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="endDatetime" class="form-label">End Datetime:</label>
                                            <input type="datetime-local" class="form-control" id="endDatetime" name="endDatetime" required>
                                        </div>
                    
                                        <!-- Medication -->
                                        <div class="mb-3">
                                            <label for="medicationName" class="form-label">Medication Name:</label>
                                            <input type="text" class="form-control" id="medicationName" name="medicationName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="medicationPrice" class="form-label">Medication Price:</label>
                                            <input type="text" class="form-control" id="medicationPrice" name="medicationPrice" required>
                                        </div>
                    
                                    </form>
                                </div>
                    
                                <!-- Modal Footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="submitTreatment()">Submit Treatment</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal" id="acceptExamineModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">Accept Examine</h4>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                    
                                <!-- Modal Body -->
                                <div class="modal-body">
                                    <!-- Form elements for examination details -->
                                    <form id="acceptExamineForm">
                                        <div class="mb-3">
                                            <label for="mcodeExamine" class="form-label">MCode (List of Codes for Medicine):</label>
                                            <input type="text" class="form-control" id="mcodeExamine" name="mcodeExamine" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="examDatetime" class="form-label">Exam Datetime:</label>
                                            <input type="datetime-local" class="form-control" id="examDatetime" name="examDatetime" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="doctorID" class="form-label">Doctor ID:</label>
                                            <input type="text" class="form-control" id="doctorID" name="doctorID" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="numberOfMedExamine" class="form-label">Number of Med:</label>
                                            <input type="number" class="form-control" id="numberOfMedExamine" name="numberOfMedExamine" required>
                                        </div>
                                    </form>
                                </div>
                    
                                <!-- Modal Footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="submitExamine()">Submit Examine</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Content for Search and Export -->
                    <div id="searchExportContent" style="display: none;">
                        <h2 id="searchExportTable">Search and Export</h2>
                        
                        <!-- Search Bar Section -->
                        <div>
                            <label for="searchByName">Doctor's Name:</label>
                            <input type="text" id="input_name" class="form-control">
                        </div>
                        
                        <div>
                            <label for="searchByIP">Doctor's ID:</label>
                            <input type="text" id="input_id" class="form-control">
                        </div>
                        

                        <div class="col-md-12">
                            <button id="search_by_doctor_button" class="btn btn-primary" type="button" >Search</button>
                        </div>

                        <!-- Filtered Patient List Section -->
                        <div id="filteredPatientsList">
                            <h3>Filtered Patients</h3>
                            <table id="filteredPatientsTable" class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Phone Number</th>
                                        <th>Address</th>
                                        <th>Date of Birth</th>
                                        <th>Gender</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Filtered patients will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                        
    
                    </div>

                    <!-- Modal dislay patient infor-->
                    <div class="modal fade" id="patientInfoModal" tabindex="-1" role="dialog" aria-labelledby="patientInfoModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="patientInfoModalLabel">Patient Information</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <!-- Dynamic patient details will be loaded here -->
                                    <div id="patientDetails"></div>
                                    <hr>
                                    <h6>Treatments</h6>
                                    <div id="patientTreatments"></div>
                                    <hr>
                                    <h6>Examinations</h6>
                                    <div id="patientExaminations"></div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                      </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    
    <script>
        function changeTab(tab) {
            // Hide all content sections
            $('#patientsTableContent').hide();
            $('#addTreatmentContent').hide();
            $('#addExamineContent').hide();
            $('#searchExportContent').hide();

            // Remove 'active' class from all links
            $('#sidebar .nav-link').removeClass('active');

            // Show the selected content section
            if (tab.innerText === "Patient List") {
                $('#patientsTableContent').show();
            } else if (tab.innerText === "Search and Export") {
                $('#searchExportContent').show();
            }

            // Add 'active' class to the clicked link
            $(tab).addClass('active');

            // Log the clicked tab for demonstration purposes
            console.log("Tab clicked: " + tab.innerText);
        }

        $(document).ready(function () {

                // Show the modal when the "Add New Patient" button is clicked
                $('#addPatientButton').click(function () {
                    $('#addPatientModal').modal('show');
                });

                
        });

        function editPatient(id) {
            // Implement logic to edit patient information
            console.log("Edit Patient clicked for ID: " + id);
        }

        //This is for search by doctor
        $(document).ready(function() {
            $('#search_by_doctor_button').click(function() {
                console.log('Search button clicked');
                var doctorName = $('#input_name').val();
                var doctorID = $('#input_id').val();
                
                // Perform the AJAX GET request
                $.ajax({
                    url: '/search_by_doctor',
                    type: 'GET',
                    data: {
                        doctor_name: doctorName,
                        doctor_id: doctorID
                    },
                    dataType: 'json',
                    success: function(data) {
                        // Clear the table before inserting new rows
                        $('#filteredPatientsTable tbody').empty();

                        // Iterate over the patient_list received from the server
                        $.each(data, function(index, patient) {
                            // Create a table row for each patient
                            var row = $('<tr>').append(
                                $('<td>').text(patient.id),
                                $('<td>').text(patient.first_name),
                                $('<td>').text(patient.last_name),
                                $('<td>').text(patient.phone_number),
                                $('<td>').text(patient.address),
                                $('<td>').text(patient.date_of_birth),
                                $('<td>').text(patient.gender),
                                $('<td>').html('<button class="btn btn-primary" onclick="exportReport(\'' + patient.id + '\')">Export Report</button>')


                            );
                            // Append the row to the table body
                            $('#filteredPatientsTable tbody').append(row);
                        });
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        // Handle any errors by logging to console or displaying to user
                        console.log('Error fetching patient list:', textStatus, errorThrown);
                    }
                });
                

            });
        });
        

        // Function to handle the export of a specific patient report
        function exportReport(patientId) {
        // Fetch the patient data
        $.ajax({
            url: '/export_patient_details',  // Replace with the actual URL to your Flask route
            type: 'GET',
            data: { patient_id: patientId },
            dataType: 'json',
            success: function(response) {
            // Populate the patient details
            var details = response.patient;
            $('#patientDetails').html(
                '<p><strong>ID:</strong> ' + details.id + '</p>' +
                '<p><strong>Name:</strong> ' + details.first_name + ' ' + details.last_name + '</p>' +
                '<p><strong>Phone Number:</strong> ' + details.phone_number + '</p>' +
                '<p><strong>Address:</strong> ' + details.address + '</p>' +
                '<p><strong>Date of Birth:</strong> ' + details.date_of_birth + '</p>' +
                '<p><strong>Gender:</strong> ' + details.gender + '</p>'
            );

            // Populate the treatments
            var treatments = response.treatments; // Assuming this is an array
            $('#patientTreatments').empty();
            treatments.forEach(function(treatment) {
                $('#patientTreatments').append('<p>' + treatment.description + '</p>'); // Replace with actual treatment fields
            });

            // Populate the examinations
            var examinations = response.examinations; // Assuming this is an array
            $('#patientExaminations').empty();
            examinations.forEach(function(examination) {
                $('#patientExaminations').append('<p>' + examination.description + '</p>'); // Replace with actual examination fields
            });

            // Show the modal
            $('#patientInfoModal').modal('show');
            },
            error: function(error) {
            console.error('Error fetching patient data:', error);
            }
        });
        }

        function addTreatment(patientCode) {
            // Implement logic to show the Accept Treatment modal for the selected patient
            console.log("Add Treatment clicked for patient Code: " + patientCode);
            
            // Show the Accept Treatment modal
            $('#acceptTreatmentModal').modal('show');

            // Optionally, you can set patientCode in the modal for further processing
            $('#acceptTreatmentModal').data('patientCode', patientCode);
        }

        function addExamine(patientCode) {
            // Implement logic to add examine for the selected patient
            console.log("Add Examine clicked for patient Code: " + patientCode);
        }

        function addExamine(patientCode) {
            // Implement logic to show the Accept Examine modal for the selected patient
            console.log("Add Examine clicked for patient Code: " + patientCode);

            // Show the Accept Examine modal
            $('#acceptExamineModal').modal('show');

            // Optionally, you can set patientCode in the modal for further processing
            $('#acceptExamineModal').data('patientCode', patientCode);
        }

        // Function to submit the examination details
        function submitExamine() {
            // Retrieve values from modal form elements (mcode, exam datetime, doctor id, number of med)
            var mcodeExamine = document.getElementById('mcodeExamine').value;
            var examDatetime = document.getElementById('examDatetime').value;
            var doctorID = document.getElementById('doctorID').value;
            var numberOfMedExamine = document.getElementById('numberOfMedExamine').value;

            // Retrieve patientCode from the modal data
            var patientCode = $('#acceptExamineModal').data('patientCode');

            // Additional logic to handle the submission of examination details
            console.log('Patient Code: ' + patientCode);
            console.log('MCode: ' + mcodeExamine);
            console.log('Exam Datetime: ' + examDatetime);
            console.log('Doctor ID: ' + doctorID);
            console.log('Number of Med: ' + numberOfMedExamine);

            // Perform further processing or submission logic

            // Close the modal
            $('#acceptExamineModal').modal('hide');
        }

        // Function to submit the treatment details
        function submitTreatment() {
            // Retrieve values from modal form elements for IP Detail
            var ICode = document.getElementById('ICode').value;
            var admissionDate = document.getElementById('admissionDate').value;
            var diagnosis = document.getElementById('diagnosis').value;
            var sickroom = document.getElementById('sickroom').value;
            var dischargeDate = document.getElementById('dischargeDate').value;
            var fee = document.getElementById('fee').value;

            // Retrieve values from modal form elements for Treat Attribute
            var doctorID = document.getElementById('doctorID').value;
            var startDatetime = document.getElementById('startDatetime').value;
            var endDatetime = document.getElementById('endDatetime').value;

            // Retrieve values from modal form elements for Medication
            var medicationName = document.getElementById('medicationName').value;
            var medicationPrice = document.getElementById('medicationPrice').value;

            // Retrieve patientCode from the modal data
            var patientCode = $('#acceptTreatmentModal').data('patientCode');

            // Additional logic to handle the submission of treatment details
            console.log('Patient Code: ' + patientCode);
            console.log('ICode: ' + ICode);
            console.log('Admission Date: ' + admissionDate);
            console.log('Diagnosis: ' + diagnosis);
            console.log('Sickroom: ' + sickroom);
            console.log('Discharge Date: ' + dischargeDate);
            console.log('Fee: ' + fee);
            console.log('Doctor ID: ' + doctorID);
            console.log('Start Datetime: ' + startDatetime);
            console.log('End Datetime: ' + endDatetime);
            console.log('Medication Name: ' + medicationName);
            console.log('Medication Price: ' + medicationPrice);

            // Perform further processing or submission logic

            // Close the modal
            $('#acceptTreatmentModal').modal('hide');
        }
            

        function logout() {
            // Show a confirmation dialog to the user
            var confirmLogout = confirm("Are you sure you want to log out?");
            
            if (confirmLogout) {
                // Perform logout tasks here, such as clearing session data

                // Redirect the user to the login page
                window.location.href = "/";
            }
        }
    </script> 
    
</body>

</html>
